## Задача

Спроектировать и задокументировать API в Swagger для новой фичи на основе анализа архитектуры (C4) и макета.

## Процесс работы

### Архитектура приложения и модель С4

Проведен анализ [расшифровки встречи с архитектором](https://docs.google.com/document/d/1E1FYjQ4kXn_VuqZVjIv0X3Ml3IWQyWHXB57RJsv5UsM/edit?usp=sharing). На основании анализа доработана контекстная диаграмма C4, описывающая архитектуру приложения LUCKY.

Дополнения к диаграмме:

*   **Описания компонентов:** Добавлены описания каждого ключевого компонента (Mobile App, API Gateway, Load Balancer, AuthServer, Shopping Cart, Payment, Shipping, внешние системы Система PAY-PAY, Система SHIP-SHIP, и др.), что позволяет понять их назначение в системе.
*   **Протоколы взаимодействия:** Указаны протоколы взаимодействия между компонентами (REST, TCP, SFTP, QUERY), что облегчает понимание потоков данных и связности системы.


![Обновленная диаграмма UML](https://github.com/EVTrukhina/practicum_Y/blob/main/Модель%20С4%20диаграмма%20для%20LUCKY.png)
<p align="center">Рис 1. Модель С4 </p>

**1. Архитектурные паттерны:**

*   **Database per service:** Каждый микросервис имеет собственную базу данных, доступ к которой осуществляется исключительно через API сервиса. Это обеспечивает независимость и автономность микросервисов, избегая общей базы данных.
*   **Server-side discovery:** Приложение использует Service Registry и Load Balancer на стороне сервера для динамического обнаружения сервисов и распределения нагрузки. Load Balancer располагается на стороне сервера, что соответствует архитектурному паттерну.

**2. Компоненты и взаимодействие:**

*   **Микросервисная архитектура:** Система состоит из 7 микросервисов: User, Store, Shopping Cart, Films, Insurance, Shipping, Payment.
*   **Внешние системы:** Для полноценной работы приложения LUCKY необходимы 4 внешние системы:
    *   **PAY-PAY:** Проведение платежей.
    *   **SHIP-SHIP:** Оформление доставки.
    *   **CRM:** Обработка заказов оператором.
    *   **Amazon S3:** Хранение медиафайлов.
*   **Взаимодействие с Kafka:** Новый сервис взаимодействует с сервисом Shopping Cart через Kafka.

**3. Kafka: Асинхронный брокер сообщений:** 

На C4-диаграмме использование Kafka представлено как TCP-соединение между Load Balancer, Kafka и Shopping Cart. Взаимодействие между этими компонентами асинхронное: они обмениваются сообщениями через Kafka, выступающую в роли брокера. Это позволяет сервисам работать независимо и повышает отказоустойчивость системы.

**Примеры использования Kafka в LUCKY:**

*   Когда пользователь добавляет товар в корзину, новый сервис отправляет сообщение в Kafka, которое обрабатывается сервисом Shopping Cart. Это позволяет асинхронно обновить состав корзины пользователя.

*   Когда пользователь оформляет заказ, сервис Shopping Cart отправляет сообщение в Kafka, которое обрабатывается сервисами Payment и Shipping.



### Проектирование API

**Задача:** Спроектировать API для нового раздела «Страхование домашних животных» в приложении LUCKY, позволяющего пользователям просматривать описание страховок для котов и собак.

**Допущения:**

*   Функциональность добавления товара в корзину и оплаты уже реализована и не требует проектирования.
*   На текущий момент доступны страховки для котов и собак, с возможностью добавления других видов животных в будущем.
*   Пользователь заказывает услугу страхования в приложении, детали (информация о животном) предоставляются позже, при оформлении документов.

![Обновленная диаграмма UML](https://github.com/EVTrukhina/practicum_Y/blob/main/Макет%20LUCKY.png)

### Моделирование профиля API

**Определение цифровых возможностей. Дополненная история пользователя (Job Story):**

*   *Когда у меня* активный и любопытный питомец,
*   *Я хочу* оформить страховку для домашнего животного,
*   *Чтобы* получать помощь в рамках страховой программы.

**Определение действий и их шагов:**

| Цифровая возможность | Действие                    | Шаг действия                  | Участник   | Описание                                                                 |
|-----------------------|---------------------------|-------------------------------|------------|---------------------------------------------------------------------------|
| Оформить страховку    | Ознакомиться со страховками | Ознакомиться со страховками    | Пользователь | Получить информацию обо всех страховках                                     |
| Оформить страховку    | Положить страховку в корзину | Добавить страховку в корзину  | Пользователь | Добавить страховку в корзину                                              |
| Оформить страховку    | Оплатить страховку         | Оплатить страховку             | Пользователь | Оплатить выбранные товары в корзине с помощью интернет-эквайринга        |

**Определение границ API. Группировка действий и шагов:**

| Цифровая возможность | Действие                    | Шаг действия                  | Участник   | Описание                                                                 |
|-----------------------|---------------------------|-------------------------------|------------|---------------------------------------------------------------------------|
| Оформить страховку    | Ознакомиться со страховками | Ознакомиться со страховками    | Пользователь | Получить информацию обо всех страховках                                     |
| Оформить страховку    | Положить страховку в корзину | Добавить страховку в корзину  | Пользователь | Добавить страховку в корзину                                              |
| Оформить страховку    | Оплатить страховку         | Оплатить страховку             | Пользователь | Оплатить выбранные товары в корзине с помощью интернет-эквайринга        |

**Моделирование профилей API. Описание функциональных возможностей (операций):**

| Название операции | Описание операции                        | Участники   | Ресурсы    | Детали операции                                                                                                                                                                                              |
|-------------------|-------------------------------------------|------------|------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `получитьСтраховки()` | Получить информацию обо всех страховках | Пользователь | Страховка  | Параметры запроса: Отсутствует. <br> Возвращает ресурс: Страховка. <br> Возвращает ответ:  <ul><li>описаниеСтраховки</li><li>ценаСтраховки</li><li>типЖивотного</li><li>периодСтрахования</li></ul> <br> Безопасная / синхронная |


**Высокоуровневое проектирование API:**

*   Тип API: Внутренний, REST API
*   Формат данных: JSON



