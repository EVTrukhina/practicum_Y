#  Описание бизнес логики
У каждой школы есть свой Редактор Школы. Редактор школы внутри школы (mult-front) здесь имеет доступ РШ рамках своей школы. Внутренний системный редактор школ (dg-core) Distant Global.

### Обновленная Use Case Diagram UML

* В редакторе школы добавить возможность отметить поля профиля для фильтрации студентов при назначении ментору

* У АП при прикреплении студентов к ментору выводить настроенный список фильтров

* Дать возможность АП выбрать всех / открепить всех участников для ментора с учетом фильтров

* Дать возможность АП выбрать всех / открепить всех участников для наставника с учетом фильтров

![Обновленная диаграмма UML](https://github.com/EVTrukhina/practicum_Y/blob/main/ВИ%20фильтрация.png)
<p align="center">Рис 1. Обновленная Use Case Diagram UML </p>

### Анализ функций

| Функция                        | Администратор проекта | Ментор | Наставник |
| ------------------------------ | ----------------------- | -------- | --------- |
| 1. Роли                       | Администратор проекта | Наставник | Наставник (только) |
| 2. Назначить студентов       | Есть                    | Есть     | Есть      |
| 3. Фильтр по параметрам      | Нет                     | Есть     | Есть      |
| 4. Открепить / выбрать всех | Есть                    | Нет      | Нет       |
| 5. Поиск                       | Есть (Ф, И, эл. почта)  | Есть (названию группы) | Есть (названию группы) |
| 6. Список участников            | Есть                    | Есть     | Есть      |




## Задача 1

**Формулировка:** Я как РШ хочу иметь возможность в редакторе школы указать список полей профиля для фильтрации участников проекта при назначении их ментору.

**Критерии приемки:**

*   В редакторе школы в разделе "Настройки профиля" отображается блок "Настройки фильтров для ментора", в котором есть список чекбоксов с полями профиля, выбранными для отображения у пользователя.
*   РШ в блоке "Настройки фильтров для ментора" может отметить чекбоксы для фильтрации списка участников при назначении их ментору.

**Frontend:**

*   В редакторе школы реализовать UI компонент для выбора списка полей профиля для ментора, аналогичный компоненту для фильтров для наставника в разделе "Настройки профиля".
*   Визуально идентичен компоненту фильтров наставника.
*   Заголовок: «Фильтры для поиска пользователей (для роли <ментора>)» (название роли в соответствии с алиасами).

**Backend:**

*   добавить поле `mentorFields` в схему коллекции `Schools` в базе данных
*   Редактор школы `dg-core`:
    *   добавить отправку поля `mentorFields` в редактор школы по GET-запросу `/api/v1/schools/get-one/{id}`
    *   добавить отправку поля `mentorFields` при сохранении изменений в редакторе школы по PUT-запросу `/api/v1/schools/update/{id}`
*   Редактор школы `mult-front`:
    *   добавить отправку поля `mentorFields` в редактор школы по GET-запросу `/api/v1/schools/current`
    *   добавить отправку поля `mentorFields` при сохранении изменений в редакторе школы по PUT-запросу `/api/v1/schools/update-current`


**UI Макет:** [ссылка](https://www.figma.com/design/UVubCChMXKksUPdVwVvLeU/Distant?node-id=5076-911&t=rcNjAHPOlmlyKnyT-1)


## Задача 2

**Формулировка:** Я как АП хочу иметь возможность при закреплении участников за ментором фильтровать их по заданным в настройках школы фильтрам.

**Критерии приемки:**

*   В модалке для прикрепления участников проекта к ментору должны отображаться фильтры по тем полям профиля, которые выбраны в настройках школы (блок "Настройки фильтров для ментора").
*   АП может заполнить какие-то поля в фильтрах и нажать кнопку "Найти", чтобы список еще не закрепленных участников обновился в соответствии с фильтрами.

**Примечания:**

*   Уточнить по полю поиска, дублирует функционал фильтрации.

**Frontend:**

*   В модалке для прикрепления участников проекта к ментору реализовать UI компонент для фильтрации по полям профиля, которые выбраны в настройках школы (блок "Настройки фильтров для ментора").
*   Если в результате фильтрации совпадений не найдено, должно выводиться сообщение "Нет данных для отображения".

**Backend:**

*   Добавить запрос `GET /api/v1/schools/get-filters-for-mentor/{projectId}`, чтобы получить список фильтров поиска студентов для ментора по полям профиля. Если нет включенных полей профиля фильтров для роли ментора в редакторе школы, то в ответе возвращается пустой массив.
*   В запросе `GET /api/v1/payments/get-user-for-mentor/{productId}/{mentorId}` добавить query-параметры `pageCount`, `page`, `filters`, чтобы список еще не закрепленных участников обновился в соответствии с фильтрами.


  ## Задача 2.1

**Формулировка:** Я как АП хочу иметь возможность в один клик закрепить / открепить всех участников за ментором, с учетом указанных фильтров.

**Критерии приемки:**

*   Кнопки "Выбрать всех студентов" и "Открепить всех студентов" остаются как и сейчас, но открепление / закрепление происходит с учетом выбранных в модалке фильтров.

**Frontend:**

*   В модалке при нажатии на кнопки "Выбрать всех студентов" и "Открепить всех студентов" за ментором, закрепление происходит с учетом query-параметров фильтров.

**UI Макет:** [ссылка](https://www.figma.com/design/UVubCChMXKksUPdVwVvLeU/Distant?node-id=5076-4&t=2chQheQgQfuuIVVQ-1)

![Диаграмма последовательности для задачи 2 и 2.1](https://github.com/EVTrukhina/practicum_Y/blob/main/задача%202%20min.png)
<p align="center">Рис 2. Диаграмма последовательности для задачи 2 и 2.1 </p>


## Задача 3

**Формулировка:** Я как АП хочу иметь возможность в один клик закрепить / открепить всех участников за наставником, с учетом указанных фильтров.

**Критерии приемки:**

*   В модалке для закрепления участников за наставником добавлена кнопка "Выбрать всех студентов", по клику на которую, все студенты с учетом указанных фильтров закрепляются за данным наставником.
*   В модалке для закрепления участников за наставником добавлена кнопка "Открепить всех студентов", по клику на которую, все студенты с учетом указанных фильтров открепляются от наставника.

**Frontend:**

*   В модалке для наставника в верхней части добавить две кнопки "Выбрать всех студентов" и "Открепить всех студентов".

**Backend:**

*   После получения отфильтрованного списка участников:
    *   Добавить запрос при нажатии на кнопку "Выбрать всех студентов" `POST api/v1/project-roles/select-all-students/{projectId}/{teacherId}` для прикрепления всех студентов к наставнику.
    *   Добавить запрос при нажатии на кнопку "Открепить всех студентов" `POST /api/v1/project-roles/remove-all-students/{projectId}/{teacherId}` для открепления всех студентов от наставника.
    *   Обработка ошибок, как в эндпоинтах `POST api/v1/project-roles/select-all-students/{projectId}/{mentorId}` и `POST /api/v1/project-roles/remove-all-students/{projectId}/{mentorId}`.

**UI Макет:** [ссылка](https://www.figma.com/design/UVubCChMXKksUPdVwVvLeU/Distant?node-id=5076-458&t=2chQheQgQfuuIVVQ-1)

